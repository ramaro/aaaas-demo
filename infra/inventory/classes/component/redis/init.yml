parameters:
  redis:
    image: redis:5.0.7
    bind_port: 6379

    args:
      - --port
      - ${redis:bind_port}

    _compile:
      kubernetes:
        - output_path: manifests_helm
          input_type: helm
          input_paths:
            - components/redis/chart
          helm_params:
            release_name: ${target}
            namespace: ${target}

      compose:
        - output_path: manifests
          input_type: jsonnet
          input_paths:
            - components/redis/main.jsonnet
          output_type: yaml
    _dependencies:
      kubernetes:
        - type: git
          output_path: components/redis/chart
          source: git@github.com:helm/charts.git
          subdir: stable/redis
          ref: 69ef199
      compose: []

  kapitan:
    compile: ${redis:_compile:${platform}}
    dependencies: ${redis:_dependencies:${platform}}
